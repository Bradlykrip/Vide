var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","fs","process","./index","./html","./config"],e)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=__importDefault(e("fs")),n=e("process"),s=e("./index"),i=e("./html"),l=e("./config"),r=e("chalk"),c=i.Components,a=(Object.keys(c),[]);console.log(`${r.blue("●")} Compiling components`),s.Clean.forEach(e=>{const t=e("component");Object.keys(t).forEach(o=>{const n=t[o].attribs;null==n||(n.from=e.prototype.name,a.push(n))})}),a.forEach(e=>{c[e.name].from=e.from,console.log(`${r.blue("   ●")} Built component named: ${e.name}`)});const p=[];s.Clean.forEach((e,t)=>{e("import").get().forEach(t=>{const s=t.attribs.name,i=c[s];if(null==i&&(console.log(`${r.red("   ●")} The component ${s} does not exist: ${e.prototype.name}`),n.exit()),"state"==i.attribs.metadata){const e=i.fullText(`component[name=${i.attribs.name}]`).html();i.inner=e.trim(),delete i.fullText,p.push(i),delete c[s]}else{if("css"==i.attribs.type){const t=`\n/* From ${i.attribs.name} in file ${i.from}*/\n${i.innerText}`;if(e.prototype.name=e.prototype.name.split(".vide")[0],null==l.config.outDir){let n="";o.default.existsSync(`./css-${e.prototype.name}.css`)&&(n=o.default.readFileSync(`./css-${e.prototype.name}.css`,"utf-8"),o.default.unlinkSync(`./css-${e.prototype.name}.css`)),o.default.writeFileSync(`./css-${e.prototype.name}.css`,`${n}\n${t}`)}else{let n="";o.default.existsSync(`${l.config.outDir}/css-${e.prototype.name}.css`)&&(n=o.default.readFileSync(`${l.config.outDir}/css-${e.prototype.name}.css`,"utf-8"),o.default.unlinkSync(`${l.config.outDir}/css-${e.prototype.name}.css`)),o.default.writeFileSync(`${l.config.outDir}/css-${e.prototype.name}.css`,`${n}\n${t}`)}}if("html"==i.attribs.type){const t=i.fullText(`component[name=${i.attribs.name}]`).html(),n=e(`import[name=${i.attribs.name}]`),s=`${e.html(n).trim().split("</import>")[0]}</import>`;let r,c;e.prototype.name=e.prototype.name.split(".vide")[0],null==l.config.outDir?(c=`./${e.prototype.name}.html`,r=o.default.readFileSync(c,"utf-8")):(c=`${l.config.outDir}/${e.prototype.name}.html`,r=o.default.readFileSync(c,"utf-8"));const a=r.replace(new RegExp(s,"g"),t);o.default.writeFileSync(c,a)}"js"!=i.attribs.type&&"js"!=i.attribs.type||console.log("hi")}})}),console.log(`${r.blue("   ●")} Rendered imports`),t.default=p});